---
title: 比较 commonjs 和 ESM 模块使用方式
comments: true
top: false
date: 2019-10-31 22:16:00
img: https://qiniu1.lxfriday.xyz/blog/javascript_20191031221809.jpg
categories: javascript
tags:
  - commonjs
  - esm
---

<section id="layout" class="layout" style="font-size: 16px; color: black; padding: 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;"><h2 style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; color: black; font-size: 24px;"><span>commonjs</span></h2>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">commonjs 中有几个特别的变量，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">module</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">exports</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">require</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">global</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">__filename</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">__dirname</code>。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">在一个 js 文件中输入下面这行，你会发现可以打印出 5 个 argument。</p>
<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">arguments</span>);
</code></pre>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">它们分别对应的就是：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">exports</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">require</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">module</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">__filename</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">__dirname</code>。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">commonjs 的导出机制比较简单，只有 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">module.exports</code> 和 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">exports</code>。需要注意的是，他们指向的都是同一个对象。如果对 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">module.exports</code> 赋值，则通过 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">exports.xxx</code> 导出的所有变量都会失效，它所指向的对象和 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">module.exports</code> 指向的不是同一个对象，而导出时是以 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">module.exports</code> 指向的对象为准。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">require</code> 是动态导入模块的，只有执行到 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">require</code> 语句的时候才会导入模块，它导入的是模块的一个拷贝。模块导入一次之后就会被缓存起来，后面再导入时都是使用的已缓存的版本。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">举个简单例子，下面代码会先打印 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">index</code> 再打印 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">a</code>。如果把 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">require</code> 换成 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">import</code>，则会先打印 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">a</code> 再打印 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">index</code>。</p>
<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// a.js</span>
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(<span class="hljs-string" style="line-height: 26px; color: #d14;">'a'</span>)

<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// index.js</span>
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(<span class="hljs-string" style="line-height: 26px; color: #d14;">'index'</span>)
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">require</span>(<span class="hljs-string" style="line-height: 26px; color: #d14;">'./a'</span>)
</code></pre>

<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;">node index.js
</code></pre>
<h2 style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; color: black; font-size: 24px;"><span>ESM</span></h2>
<h3 style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; color: black; font-size: 20px;"><span>常见导入导出</span></h3>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">ESM 全称叫 ECMA Script Modules，是在 ES6 语言层面提出的一种模块化标准。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">ES6 中主要有 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">import</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">export</code> 两个关键词。要注意他们是语法层面的关键词，所以不能使用 	<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">console.log(import)</code> 这种方式来打印。而 commonjs 中的变量都是可以打印的。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">常见的导入导出：</p>
<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 导入</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> React <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'react'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> * <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">as</span> React <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'react'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> { Component } <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'react'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> {<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">default</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">as</span> a} <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'react'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> {Button <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">as</span> Btn} <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'antd'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'index.less'</span>

<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">default</span> <span class="hljs-number" style="line-height: 26px; color: #008080;">1</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">const</span> name = <span class="hljs-string" style="line-height: 26px; color: #d14;">'lxfriday'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> { age }
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> {name <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">as</span> nickname}
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> { foo } <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'./foo-bar'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> \* <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'./foo-bar'</span>
</code></pre>

<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;"><strong style="font-weight: bold; color: black;">ES6 模块在编译阶段就可以分析出导出的结果，同时它导出的是值的引用。</strong></p>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">编译阶段会导出意味着模块的导入会先于正常的执行流执行，即使 import 导入语句是在正常语句之后（见 commonjs 的例子）；</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">ES6 导出的是一个引用，所以在对原模块做更改之后会影响新导入的值，导入时可以看做是从 getter 函数里面取值，获取的都是原模块内部的值；</section></li></ul>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">下面是一个例子：</p>
<figure style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img src="https://qiniu1.lxfriday.xyz/blog/image_20191031221658.png" alt="image" style="display: block; margin: 0 auto; width: 50%;"><figcaption style="margin-top: 5px; text-align: center; color: #888; font-size: 14px;">image</figcaption></figure>
<h3 style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; color: black; font-size: 20px;"><span>ESM 在浏览器中的应用</span></h3>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">ESM 模块语法可以在<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">比较新</a>的浏览器中使用，它的使用方式像下面的代码，需要使用 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">type = module</code> 区分。浏览器对 script 标签默认的 type 是 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">application/javascript</code>。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">浏览器对 module 标签的脚本是异步加载并执行的，模块的加载不会阻塞浏览器渲染，等到整个页面渲染完成之后，module 才会执行，这种加载执行策略和 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">defer</code> 属性相同（<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">async</code> 是异步加载完就会立即执行，会中断浏览器渲染）。</p>
<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-tag" style="line-height: 26px; color: #000080; font-weight: normal;">&lt;<span class="hljs-name" style="line-height: 26px; color: #000080; font-weight: normal;">script</span> <span class="hljs-attr" style="line-height: 26px; color: #008080;">type</span>=<span class="hljs-string" style="line-height: 26px; color: #d14;">"module"</span> <span class="hljs-attr" style="line-height: 26px; color: #008080;">src</span>=<span class="hljs-string" style="line-height: 26px; color: #d14;">"./index.js"</span>&gt;</span>xxx<span class="hljs-tag" style="line-height: 26px; color: #000080; font-weight: normal;">&lt;/<span class="hljs-name" style="line-height: 26px; color: #000080; font-weight: normal;">script</span>&gt;</span>
</code></pre>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">下面是一个例子</p>
<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// cc.js</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">default</span> { <span class="hljs-attr" style="line-height: 26px;">aa</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">"aaa"</span>, <span class="hljs-attr" style="line-height: 26px;">bb</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">"bbb"</span> };
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">var</span> value = <span class="hljs-number" style="line-height: 26px; color: #008080;">100</span>;

<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// index.js</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> cc <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">"./cc.js"</span>;
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(<span class="hljs-string" style="line-height: 26px; color: #d14;">"module in browser"</span>, cc);
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(value);
</code></pre>

<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-tag" style="line-height: 26px; color: #000080; font-weight: normal;">&lt;<span class="hljs-name" style="line-height: 26px; color: #000080; font-weight: normal;">body</span>&gt;</span>
  hello
  <span class="hljs-tag" style="line-height: 26px; color: #000080; font-weight: normal;">&lt;<span class="hljs-name" style="line-height: 26px; color: #000080; font-weight: normal;">script</span> <span class="hljs-attr" style="line-height: 26px; color: #008080;">src</span>=<span class="hljs-string" style="line-height: 26px; color: #d14;">"./index.js"</span> <span class="hljs-attr" style="line-height: 26px; color: #008080;">type</span>=<span class="hljs-string" style="line-height: 26px; color: #d14;">"module"</span>&gt;</span><span class="hljs-tag" style="line-height: 26px; color: #000080; font-weight: normal;">&lt;/<span class="hljs-name" style="line-height: 26px; color: #000080; font-weight: normal;">script</span>&gt;</span>
<span class="hljs-tag" style="line-height: 26px; color: #000080; font-weight: normal;">&lt;/<span class="hljs-name" style="line-height: 26px; color: #000080; font-weight: normal;">body</span>&gt;</span>
</code></pre>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">执行结果</p>
<figure style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img src="https://qiniu1.lxfriday.xyz/blog/image_20191031221651.png" alt="image" style="display: block; margin: 0 auto; width: 50%;"><figcaption style="margin-top: 5px; text-align: center; color: #888; font-size: 14px;">image</figcaption></figure>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">可以看到，模块正常导入并打印了，但是在 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">cc.js</code> 中定义的变量 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">value</code>，在 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">index.js</code> 中获取不到，这说明  <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">type=module</code> 有作用域限制。</p>
<h2 style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; color: black; font-size: 24px;"><span>commonjs 和 ESM 混合使用</span></h2>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">当它们混合使用的时候很容易产生混乱，在导入的时候，推荐把 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">import</code> 语句都放在 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">require</code> 语句前面。在不同时期，由于语法标准不完善，导入导出都存在差异，下面例子基于 webpack <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">4.41.2</code> 测试得出。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">看看下面的例子：</p>
<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 对 import xx from './aa.js'</span>

<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">module</span>.exports = xx
<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 等同于 </span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">default</span> xx
</code></pre>

<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 对 import { aa, bb } from './cc.js' 或者 const { aa, bb } = require('./cc.js')</span>

<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">module</span>.exports = { <span class="hljs-attr" style="line-height: 26px;">aa</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">'aaa'</span>, <span class="hljs-attr" style="line-height: 26px;">bb</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">'bbb'</span> }
<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 等同于</span>
exports.aa = <span class="hljs-string" style="line-height: 26px; color: #d14;">'aaa'</span>
exports.bb = <span class="hljs-string" style="line-height: 26px; color: #d14;">'bbb'</span>
<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 等同于</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">const</span> aa = <span class="hljs-string" style="line-height: 26px; color: #d14;">'aaa'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">const</span> bb = <span class="hljs-string" style="line-height: 26px; color: #d14;">'bbb'</span>
</code></pre>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">下面两个例子要多加注意</p>
<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// cc.js</span>
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">module</span>.exports = { <span class="hljs-attr" style="line-height: 26px;">aa</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">'aaa'</span>, <span class="hljs-attr" style="line-height: 26px;">bb</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">'bbb'</span> }

<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// index.js</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> cc <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'./cc.js'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> \* <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">as</span> dd <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'./cc.js'</span>

<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(cc)
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(dd)
<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 打印的结果相同，为 {aa: "aaa", bb: "bbb"}</span>
</code></pre>

<pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch; overflow-x: auto; padding: 16px; color: #333; background: #f8f8f8; display: -webkit-box !important;"><span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// cc.js</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">export</span> <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">default</span> { <span class="hljs-attr" style="line-height: 26px;">aa</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">'aaa'</span>, <span class="hljs-attr" style="line-height: 26px;">bb</span>: <span class="hljs-string" style="line-height: 26px; color: #d14;">'bbb'</span> }

<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// index.js</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> cc <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'./cc.js'</span>
<span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">import</span> * <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">as</span> dd <span class="hljs-keyword" style="line-height: 26px; color: #333; font-weight: bold;">from</span> <span class="hljs-string" style="line-height: 26px; color: #d14;">'./cc.js'</span>

<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(cc)
<span class="hljs-built_in" style="line-height: 26px; color: #0086b3;">console</span>.log(dd)
<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// 打印的结果不同</span>
<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// cc =&gt; {aa: "aaa", bb: "bbb"}</span>
<span class="hljs-comment" style="line-height: 26px; color: #998; font-style: italic;">// dd =&gt; Module&nbsp;{default: {…}, __esModule: true, Symbol(Symbol.toStringTag): "Module"}</span>
</code></pre>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">可以看出，使用 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">export default</code> 这种 ES6 方式导出的结果，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">import * as</code> 可以准确的实现自身的语义，把模块里面所有导出的都挂载模块对象中。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">ES6 模块中，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">import a from './xx'</code> 是 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">import { default as a } from './xx'</code> 的简写。表示把 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">xx</code> 模块中用 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">export default</code> 导出的变量导入。</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;"><strong style="font-weight: bold; color: black;">参考</strong></p>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="http://es6.ruanyifeng.com/#docs/module-loader" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">阮一峰 module-loader</a></section></li></ul>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">今天的文章就到这里，感谢阅读~</p>
<p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">欢迎大家关注我的掘金和公众号</p>
<figure style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img src="https://qiniu1.lxfriday.xyz/blog/image_20191031220057.png" alt="image" style="display: block; margin: 0 auto; width: 100%;"><figcaption style="margin-top: 5px; text-align: center; color: #888; font-size: 14px;">image</figcaption></figure>
</section>
