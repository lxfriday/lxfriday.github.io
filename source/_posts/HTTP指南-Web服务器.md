---
title: HTTP指南-Web服务器
comments: true
top: false
date: 2019-05-24 13:21:01
categories: http 
tags: http
img: https://qiniu1.lxfriday.xyz/WaterM/17a9f745-8a73-436b-ad64-8d40ffc032a4_timg.jpeg
---

## 1 通信数据转发程序：代理、网关、隧道

HTTP 通信时，出客户端和服务器外，还有一些用于通信数据转发的应用程序，例如代理、网关和隧道。它们可以配合服务器工作。

这些应用程序和服务器可以将请求转发给通信线路上的下一站服务器，并且能接受从那台服务器发送的响应再转发给客户端。

代理

**代理是一种有转发功能的应用程序**，它扮演了位于服务器和客户端中间人的角色，接受由客户端发送的请求并转发给服务器，同时也接受服务器返回的响应并转发给服务器，同时也接受服务器返回的响应并转发给客户端。

网关

网关是转发其他服务器通信数据的服务器，接受从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。有时客户端可能不会觉察到自己通信的目标就是一个网关。

隧道

隧道是在一个相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。

### 1.1 代理
<div class=img-center><img src="https://qiniu1.lxfriday.xyz/WaterM/06c202cc-6fdc-4a92-8bbd-e661fdace3a7_QQ20190524-134701.png" alt="1层代理"><p class="img-desc">1层代理</p></div>
<div class=img-center><img src="https://qiniu1.lxfriday.xyz/WaterM/3d21fdc3-63c5-4711-bbd1-41672f6e1b94_QQ20190524-134715.png" alt="多层代理"><p class="img-desc">多层代理</p></div>


代理服务器的基本行为就是接受客户端发送的请求后转发给其他的服务器。代理不改变请求 URI，会直接发送给前方持有资源的目标服务器。

持有资源实体的服务器被称为源服务器。从源服务器返回的响应经过代理服务器后再传给客户端。

**每次经过代理服务器转发请求或响应时，都会追加写入 Via 首部信息。**

在 HTTP 通信过程中，可级联多台代理服务器。请求和响应的转发会经过数台类似锁链一样连接起来的代理服务器。转发时，需要附加 Via 首部字段以标记出经过的主机信息。

代理有多重使用方式，按两种基准分类。一种是是否使用缓存，另一种是是否会修改报文。

缓存代理

代理转发响应时，缓存代理（Caching Proxy）会预先将资源的副本（缓存）保存在代理服务器上。当资源再次接受到对相同资源的请求时，就可以不从源服务器那里获取资源，而是将之前缓存的资源作为响应返回。 

透明代理

转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理（Transparent Proxy）。反之，对报文内容进行加工的代理被称为非透明代理。

### 1.2 网关
<div class=img-center><img src="https://qiniu1.lxfriday.xyz/WaterM/caf66b91-1dbb-4610-b63d-218ee8f48fea_QQ20190525-002253-wangguan.png" alt="网关"><p class="img-desc">网关</p></div>

利用网关可以由 HTTP 请求转化为其他协议请求。

网关的工作机制和代理十分相似。而网关能使通信线路上的服务器提供非 HTTP 协议服务。

利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。比如，网关可以连接数据库，使用 SQL 语句查询数据。另外，在 Web 网站上进行信用卡结算时，网关可以和信用卡结算系统联动。

### 1.3 隧道
<div class=img-center><img src="https://qiniu1.lxfriday.xyz/WaterM/305b2343-eff0-4dad-81dc-7888fbb60ab4_QQ20190525-002834-suidao.png" alt="隧道"><p class="img-desc">隧道</p></div>

隧道可按要求建立起一条与其他服务器的通信线路，届时使用 SSL 等加密手段进行通信。**隧道的目的是确保客户端能与服务器进行安全的通信**

隧道本身不会去解析 HTTP 请求。也就是说，请求保持原样中转给之后的服务器。隧道会在通信双方断开连接的时候结束。

通过隧道的传输，可以和远距离的服务器安全通信。隧道本身是透明的，客户端不用在意隧道的存在。















